{% extends "judge/base.html" %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'judge:contest_detail' contest.pk %}">Contest {{ contest.pk }}</a></li>
<li class="breadcrumb-item active" aria-current="page">New Problem</li>
{% endblock %}

{% block styles %}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block scripts %}
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    let quillModules = {
        toolbar: [
            ['bold', 'italic'],
            ['link', 'blockquote', 'code-block'],
            [{ list: 'ordered' }, { list: 'bullet' }],
        ]
    }

    let statementQuill = new Quill('#statementEditor', {
        modules: quillModules,
        placeholder: 'Add problem statement',
        theme: 'snow',
    })

    let inputFormatQuill = new Quill('#inputFormatEditor', {
        modules: quillModules,
        placeholder: 'Input format',
        theme: 'snow',
    })

    let outputFormatQuill = new Quill('#outputFormatEditor', {
        modules: quillModules,
        placeholder: 'Output format',
        theme: 'snow',
    })

    {% if post_data.statement %}
    statementQuill.setContents(JSON.parse('{{ post_data.statement }}'))
    {% endif %}

    $('form').submit(function (e) {
        // $('#noTestCasesField').val(noTestCases)
        $('#statementField').val(JSON.stringify(statementQuill.getContents()))
        $('#inputFormatField').val(JSON.stringify(inputFormatQuill.getContents()))
        $('#outputFormatField').val(JSON.stringify(outputFormatQuill.getContents()))
    })

    // let testCaseBuilder = (id) => {
    //     return `<div class="col-12">
    //                 <h6>Test ${id+1}</h6>
    //                 <div class="custom-control custom-radio custom-control-inline">
    //                     <input type="radio" name="test${id}" id="test${id}Public" class="custom-control-input">
    //                     <label class="custom-control-label" for="test${id}Public">Public</label>
    //                 </div>
    //                 <div class="custom-control custom-radio custom-control-inline">
    //                     <input type="radio" name="test${id}" id="test${id}Private" class="custom-control-input">
    //                     <label class="custom-control-label" for="test${id}Private">Private</label>
    //                 </div>
    //                 <div class="col-12 col-md-6 form-group mx-0">
    //                     <h6>Input</h6>
    //                     <input type="file" class="form-control-file" name="input${id}">
    //                 </div>
    //                 <div class="col-12 col-md-6 form-group mx-0">
    //                     <h6>Output</h6>
    //                     <input type="file" class="form-control-file" name="output${id}">
    //                 </div>
    //             </div>`
    // }
    // let noTestCases = 0;

    // $("#addTestBtn").click(function() {
    //     $("#testCasesBlock").append(testCaseBuilder(noTestCases))
    //     noTestCases++;
    // })
</script>
{% endblock %}

{% block content %}
<div class="row my-2">
    <div class="col-12">
        <h2>New Problem</h2>
    </div>
</div>
<div class="row">
    <div class="col-12 col-md-8">
        <form action="{% url 'judge:new_problem' contest.pk %}" method="POST" enctype="multipart/form-data">
            {% if error_msg %}
            <div class="alert alert-danger alter-dismissible fade show" role="alert">
                <strong>Error: </strong>{{ error_msg }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% endif %}
            {% csrf_token %}
            <div class="form-group">
                <label for="codeField">Code</label>
                <input type="text" class="form-control" id="codeField" aria-describedby="codeHelp"
                    placeholder="Problem code" name="code" value="{{ post_data.code }}">
                <small id="codeHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="nameField">Name</label>
                <input type="text" class="form-control" id="nameField" aria-describedby="nameHelp"
                    placeholder="Problem name" name="name" value="{{ post_data.name }}">
                <small id="nameHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="statementEditor">Statement</label>
                <input id="statementField" type="hidden" name="statement">
                <div id="statementEditor" aria-describedby="statementHelp"></div>
                <small id="statementHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="inputFormatEditor">Input Format</label>
                <input id="inputFormatField" type="hidden" name="input_format">
                <div id="inputFormatEditor" aria-describedby="inputFormatHelp"></div>
                <small id="inputFormatHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="outputFormatEditor">Output Format</label>
                <input id="outputFormatField" type="hidden" name="output_format">
                <div id="outputFormatEditor" aria-describedby="outputFormatHelp"></div>
                <small id="outputFormatHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="difficultyField">Difficulty</label>
                <input type="number" class="form-control" id="difficultyField" aria-describedby="difficultyHelp"
                    placeholder="Difficulty" name="difficulty" value="{{ post_data.difficulty }}">
                <small id="difficultyHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="timeLimitField">Time Limit</label>
                <input type="number" class="form-control" id="timeLimitField" aria-describedby="timeLimitHelp"
                    placeholder="Time Limt" name="time_limit" value="{{ post_data.time_limit }}">
                <small id="timeLimitHelp" class="form-text text-muted">Time limit in milliseconds</small>
            </div>
            <div class="form-group">
                <label for="memoryLimitField">Memory Limit</label>
                <input type="number" class="form-control" id="memoryLimitField" aria-describedby="memoryLimitHelp"
                    placeholder="Memory Limt" name="memory_limit" value="{{ post_data.memory_limit }}">
                <small id="memoryLimitHelp" class="form-text text-muted">Memory limit in bytes</small>
            </div>
            <div class="form-group">
                <label for="fileExtField">File Extensions</label>
                <input type="text" class="form-control" id="fileExtField" aria-describedby="fileExtHelp"
                    placeholder="File Extensions" name="file_format" value="{{ post_data.file_format }}">
                <small id="fileExtHelp" class="form-text text-muted">Accepted file extensions in submissions</small>
            </div>
            <div class="form-group">
                <label for="startCodeField">Start Code</label>
                <input type="file" class="form-control-file" id="startCodeField" aria-describedby="startCodeHelp"
                    placeholder="Start Code" name="start_code">
                <small id="startCodeHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="maxScoreField">Max. Score</label>
                <input type="number" class="form-control" id="maxScoreField" aria-describedby="maxScoreHelp"
                    placeholder="Max. score" name="max_score" value="{{ post_data.max_score }}">
                <small id="maxScoreHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="compScriptField">Compilation Script</label>
                <input type="file" class="form-control-file" id="compScriptField" aria-describedby="compScriptHelp"
                    placeholder="Compilation script" name="compilation_script">
                <small id="compScriptHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="testScriptField">Test Script</label>
                <input type="file" class="form-control-file" id="testScriptField" aria-describedby="testScriptHelp"
                    placeholder="Test script" name="test_script">
                <small id="testScriptHelp" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
                <label for="setterSolField">Setter Solution</label>
                <input type="file" class="form-control-file" id="setterSolField" aria-describedby="setterSolHelp"
                    placeholder="Setter solution" name="setter_solution">
                <small id="setterSOlHelp" class="form-text text-muted"></small>
            </div>
            <!-- <div class="row">
                <div class="col-12">
                    <h5>Test cases</h5>
                </div>
                <input type="hidden" id="noTestCasesField" name="no_test_cases" value="0">
                <div class="col-12" id="testCasesBlock"></div>
            </div>
            <button type="button" class="btn btn-primary" id="addTestBtn">Add another test case</button><br> -->
            <button type="submit" class="btn btn-primary my-3">Create</button>
        </form>
    </div>
</div>
{% endblock %}